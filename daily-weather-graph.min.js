!function(){"use strict";window.DailyWeatherGraph=function(r){var n={width:800,height:375,dateFormat:"%Y-%m-%d",missingValue:null,missingValueText:"n/a",temperatureUnit:"C",rainfallUnit:"mm",windUnit:"km/h"},i=function(t){var e={};for(var r in t)a(t,r)&&(e[r]=t[r]);return e}(r);for(var d in n)a(i,d)||(i[d]=n[d]);var l=i.data.length,o={marginTop:10,marginRight:10,marginBottom:30,marginLeft:10,regionSpacing:30,windRegionHeight:70,rainRegionHeightProp:.375,tempRegionHeightProp:.625,windSize:50,windCircleRadius:12};o.plotAreaWidth=i.width-o.marginLeft-o.marginRight,o.plotAreaHeight=i.height-o.marginTop-o.marginBottom;var s=i.height-o.marginTop-o.marginBottom-2*o.regionSpacing-o.windRegionHeight;o.rainRegionHeight=s*o.rainRegionHeightProp,o.tempRegionHeight=s*o.tempRegionHeightProp;var g=d3.select(i.container);g.html("");var u=g.append("svg").attr("width",i.width).attr("height",i.height).attr("class",t("root"));u.append("rect").attr("class",t("graph-background")).attr("x",0).attr("y",0).attr("width",i.width).attr("height",i.height);var h=u.append("rect").attr("class",t("plot-area-background")).attr("x",o.marginLeft).attr("y",o.marginTop).attr("width",o.plotAreaWidth).attr("height",o.plotAreaHeight).attr("pointer-events","all"),p=function(t){return t.date};!function(t,a){t.append("g").attr("id","daily-weather-graph-wind-icon").append("circle").attr("cx",a.windSize/2).attr("cy",a.windSize/2).attr("stroke-width","1.3px").attr("r",a.windCircleRadius);var e=a.windSize/2-a.windCircleRadius+4,r=e-8,n=a.windSize/2-4,i=a.windSize/2+4;t.append("g").attr("id","daily-weather-graph-wind-indicator").append("path").attr("d","M"+n+","+r+" L"+i+","+r+" L"+a.windSize/2+","+e+" L"+n+","+r)}(u.append("defs"),o);var c=u.append("g").attr("class",t("plot-area")).attr("transform","translate("+o.marginLeft+","+o.marginTop+")").attr("pointer-events","none"),m=d3.scaleBand().domain(e(i.data,"date")).rangeRound([0,o.plotAreaWidth]).paddingInner(.25).paddingOuter(0);!function(a,e,r,n,i){var d=function(t){var a;switch(t.windUnit){case"knots":a=1/.54;break;case"mph":a=1/.62137;break;case"m/s":a=3.6;break;default:a=1}var e={light:d3.interpolateRgb("#222222","#808080"),strong:d3.interpolateRgb("#C76100","#C70000")};return function(t){var r,n,i,d=t*a;d<50?(r="light",n=0,i=50):(r="strong",n=50,i=100);var l=(t-n)/(i-n);return l=Math.max(0,Math.min(l,1)),e[r](l)}}(r),l=a.append("g").attr("class",t("wind-region"));l.append("rect").attr("class",t("wind-region-background")).attr("x",0).attr("y",0).attr("width",n.plotAreaWidth).attr("height",n.windRegionHeight+n.regionSpacing/2);var o=l.append("g").attr("class",t("wind-icons")),s=l.append("g").attr("class",t("wind-arrows")),g=l.append("g").attr("class",t("wind-gust-labels")),u=l.append("g").attr("class",t("wind-direction-labels"));o.selectAll("wind-icon").data(r.data,i).enter().append("use").attr("xlink:href","#daily-weather-graph-wind-icon").attr("transform",function(t){if(t.highWindGustBearing===r.missingValue)return"";var a=e(t.date)+e.bandwidth()/2;return"translate("+(a-n.windSize/2)+",35)"}).style("fill",function(t){return t.highWindGust===r.missingValue?"none":d(t.highWindGust)}).style("stroke",function(t){if(t.highWindGust===r.missingValue)return"none";var a=d(t.highWindGust);return d3.rgb(a).darker(1.25)}),s.selectAll("wind-arrow").data(r.data,i).enter().append("use").attr("xlink:href","#daily-weather-graph-wind-indicator").attr("transform",function(t){if(t.highWindGustBearing===r.missingValue)return"";var a=e(t.date)+e.bandwidth()/2,i=45*Math.round(t.highWindGustBearing/45);return"translate("+(a-n.windSize/2)+",35) rotate("+i+" "+n.windSize/2+" "+n.windSize/2+")"}).style("fill",function(t){return t.highWindGustBearing===r.missingValue||0===Math.round(t.highWindGust)?"none":"#000000"}).style("stroke",function(t){return t.highWindGustBearing===r.missingValue||0===Math.round(t.highWindGust)?"none":"#FFFFFF"}),g.selectAll("text.wind-gust-label").data(r.data,i).enter().append("text").attr("class",function(a){return a.highWindGust===r.missingValue?t("na-label"):t("wind-gust-label")}).attr("x",function(t){return e(t.date)+e.bandwidth()/2}).attr("y",35+n.windSize/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.highWindGust===r.missingValue?r.missingValueText:Math.round(t.highWindGust)}),u.selectAll("text.wind-direction-label").data(r.data,i).enter().append("text").attr("class",t("wind-direction-label")).attr("x",function(t){return e(t.date)+e.bandwidth()/2}).attr("y",35).attr("text-anchor","middle").text(function(t){return t.highWindGustBearing===r.missingValue||0===Math.round(t.highWindGust)?"":(a=t.highWindGustBearing,["N","NE","E","SE","S","SW","W","NW","N"][Math.round(a/45)]);var a}),l.append("text").attr("class",t("section-label")).attr("x",5).attr("y",5).attr("dy","0.8em").text("Peak wind gust ("+r.windUnit+")")}(c,m,i,o,p),function(a,r,n,i,d){var l=d3.scaleLinear().range([i.plotAreaHeight-i.rainRegionHeight-i.regionSpacing,i.windRegionHeight+i.regionSpacing]),o=e(n.data,"highTemperature"),s=e(n.data,"lowTemperature"),g=o.concat(s).filter(function(t){return t!==n.missingValue}),u=d3.extent(g),h=u[1]-u[0];u[0]=Math.floor(u[0])-Math.max(1,.15*h),u[1]=Math.ceil(u[1])+Math.max(1,.25*h),l.domain(u);var p=d3.line().x(function(t){return r(t.date)+r.bandwidth()/2}).y(function(t){return l(t.lowTemperature)}),c=d3.line().x(function(t){return r(t.date)+r.bandwidth()/2}).y(function(t){return l(Math.round(t.highTemperature))});p.defined(function(t){return t.lowTemperature!==n.missingValue}),c.defined(function(t){return t.highTemperature!==n.missingValue});var m=a.append("g").attr("class",t("temperature-region"));m.append("rect").attr("class",t("temperature-region-background")).attr("x",0).attr("y",i.windRegionHeight+i.regionSpacing/2).attr("width",i.plotAreaWidth).attr("height",i.tempRegionHeight+i.regionSpacing),m.append("path").attr("class",t("temperature-low-path")).attr("d",p(n.data)),m.append("path").attr("class",t("temperature-high-path")).attr("d",c(n.data));var f=m.append("g").attr("class",t("temperature-high-labels")),w=m.append("g").attr("class",t("temperature-low-labels"));f.append("g").selectAll("text").data(n.data,d).enter().append("text").attr("class",t("temperature-high-label")).attr("x",function(t){return r(t.date)+r.bandwidth()/2}).attr("y",function(t){return l(t.highTemperature)}).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.highTemperature===n.missingValue?"":Math.round(t.highTemperature)}),w.append("g").selectAll("text").data(n.data,d).enter().append("text").attr("class",t("temperature-low-label")).attr("x",function(t){return r(t.date)+r.bandwidth()/2}).attr("y",function(t){return l(t.lowTemperature)}).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.lowTemperature===n.missingValue?"":Math.round(t.lowTemperature)}),m.append("line").attr("class",t("region-separator")).attr("transform","translate(0,"+(i.windRegionHeight+i.regionSpacing/2)+")").attr("x1",0).attr("x2",i.plotAreaWidth).attr("y1",0).attr("y2",0),m.append("text").attr("class",t("section-label")).attr("x",5).attr("y",i.windRegionHeight+i.regionSpacing/2).attr("dy","1.3em").text("High and low temperatures (Â°"+n.temperatureUnit+")")}(c,m,i,o,p),function(a,r,n,i,d){var l="inches"===n.rainfallUnit?.4:10,o="inches"===n.rainfallUnit?2:1,s=e(n.data,"rainfall").filter(function(t){return t!==n.missingValue}),g=d3.scaleLinear().range([0,i.rainRegionHeight-30]).domain([0,Math.max(l,d3.max(s))]).clamp(!0),u=function(t){var a="inches"===t.rainUnit?2:50,e=d3.interpolateRgb("#4BA7EB","#0023AD");return function(t){var r=Math.max(0,Math.min(t/a,1));return e(r)}}(n),h=a.append("g").attr("class",t("rain-region"));h.append("rect").attr("class",t("rain-region-background")).attr("x",0).attr("y",i.plotAreaHeight-i.rainRegionHeight-i.regionSpacing/2).attr("width",i.plotAreaWidth).attr("height",i.rainRegionHeight+i.regionSpacing/2);var p=h.append("g").attr("class",t("rain-bars")),c=h.append("g").attr("class",t("rain-labels"));p.selectAll("rect.rain-bar").data(n.data,d).enter().append("rect").attr("class",t("rain-bar")).style("fill",function(t){return 0===t.rainfall||t.rainfall===n.missingValue?"none":u(t.rainfall)}).style("stroke",function(t){if(0===t.rainfall||t.rainfall===n.missingValue)return"none";var a=u(t.rainfall);return d3.rgb(a).darker(.8)}).attr("x",function(t){return r(t.date)}).attr("y",function(t){return i.plotAreaHeight-(t.rainfall===n.missingValue?0:g(t.rainfall))}).attr("width",r.bandwidth()).attr("height",function(t){return t.rainfall===n.missingValue?0:g(t.rainfall)}),c.selectAll("text.rain-label").data(n.data,d).enter().append("text").attr("class",function(a){return t(0===a.rainfall?"rain-zero-dot":a.rainfall===n.missingValue?"missing-label":"rain-label")}).attr("text-anchor","middle").attr("x",function(t){return r(t.date)+r.bandwidth()/2}).attr("y",function(t){var a=t.rainfall===n.missingValue?0:t.rainfall;return i.plotAreaHeight-g(a)-8}).text(function(t){if(t.rainfall>0){var a=Math.pow(10,o),e=Math.round(a*t.rainfall)/a;return e<.1&&(e=(""+e).substring(1)),e}return 0===t.rainfall?".":n.missingValueText}),h.append("text").attr("class",t("section-label")).attr("x",5).attr("y",i.plotAreaHeight-i.rainRegionHeight-i.regionSpacing/2).attr("dy","1.3em").text("Daily rainfall ("+n.rainfallUnit+")"),h.append("text").attr("class",t("statistic-label")).attr("x",i.plotAreaWidth-5).attr("y",i.plotAreaHeight-i.rainRegionHeight-i.regionSpacing/2).attr("text-anchor","end").attr("dy","1.3em").text("Total: "+d3.sum(s).toFixed(o)),h.append("line").attr("class",t("region-separator")).attr("transform","translate(0,"+(i.plotAreaHeight-i.rainRegionHeight-i.regionSpacing/2)+")").attr("x1",0).attr("x2",i.plotAreaWidth).attr("y1",0).attr("y2",0)}(c,m,i,o,p);for(var f=d3.timeFormat(i.dateFormat),w=d3.timeParse(f),x=i.data.map(function(t){return w(t.date).getDate()}),y=x.indexOf(1);-1!==y;){if(y<l&&y>0){var b=i.data[y-1].date,v=i.data[y].date,H=(m(b)+m(v))/2+m.bandwidth()/2;c.append("line").attr("class",t("vertical-separator")).attr("x1",H).attr("x2",H).attr("y1",o.marginTop).attr("y2",o.plotAreaHeight+20)}y=x.indexOf(1,y+1)}var A=c.append("line").attr("class",t("cursor")).attr("x1",0).attr("x2",0).attr("y1",o.marginTop).attr("y2",o.plotAreaHeight),S=d3.axisBottom().scale(m).tickSizeInner(0).tickSizeOuter(.5).tickFormat(function(t){return parseInt(t.substr(-2),10)});c.append("g").attr("class",t("axis")+" "+t("x-axis")).attr("transform","translate(0,"+o.plotAreaHeight+")").call(S).selectAll("text").attr("dy","1.4em"),h.on("mousemove",function(){var t=d3.mouse(u.node())[0]-o.marginLeft;A.attr("x1",t).attr("x2",t)}),h.on("mouseover",function(){A.style("stroke-opacity",.8)}),h.on("mouseout",function(){A.style("stroke-opacity",0)})};function t(t){return"dwg-"+t}function a(t,a){return Object.prototype.hasOwnProperty.call(t,a)}function e(t,a){return t.map(function(t){return t[a]})}}();