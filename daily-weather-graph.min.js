!function(){"use strict";window.DailyWeatherGraph=function(n){var r={width:800,height:375,dateFormat:"%Y-%m-%d",missingValue:null,missingValueText:"n/a",temperatureUnit:"C",rainfallUnit:"mm",windUnit:"km/h"},i=function(t){var e={};for(var n in t)a(t,n)&&(e[n]=t[n]);return e}(n);for(var l in r)a(i,l)||(i[l]=r[l]);var d=i.data.length,o={marginTop:10,marginRight:10,marginBottom:30,marginLeft:10,regionSpacing:30,windRegionHeight:70,rainRegionHeightProp:.375,tempRegionHeightProp:.625,windSize:50,windCircleRadius:12};o.plotAreaWidth=i.width-o.marginLeft-o.marginRight,o.plotAreaHeight=i.height-o.marginTop-o.marginBottom;var s=i.height-o.marginTop-o.marginBottom-2*o.regionSpacing-o.windRegionHeight;o.rainRegionHeight=s*o.rainRegionHeightProp,o.tempRegionHeight=s*o.tempRegionHeightProp,i.container.html("");var g=i.container.append("svg").attr("width",i.width).attr("height",i.height).attr("class",t("root"));g.append("rect").attr("class",t("graph-background")).attr("x",0).attr("y",0).attr("width",i.width).attr("height",i.height);var u=g.append("rect").attr("class",t("plot-area-background")).attr("x",o.marginLeft).attr("y",o.marginTop).attr("width",o.plotAreaWidth).attr("height",o.plotAreaHeight).attr("pointer-events","all"),p=function(t){return t.Date};!function(t,a){t.append("g").attr("id","daily-weather-graph-wind-icon").append("circle").attr("cx",a.windSize/2).attr("cy",a.windSize/2).attr("stroke-width","1.3px").attr("r",a.windCircleRadius);var e=a.windSize/2-a.windCircleRadius+4,n=e-8,r=a.windSize/2-4,i=a.windSize/2+4;t.append("g").attr("id","daily-weather-graph-wind-indicator").append("path").attr("d","M"+r+","+n+" L"+i+","+n+" L"+a.windSize/2+","+e+" L"+r+","+n)}(g.append("defs"),o);var c=g.append("g").attr("class",t("plot-area")).attr("transform","translate("+o.marginLeft+","+o.marginTop+")").attr("pointer-events","none"),h=d3.scaleBand().domain(e(i.data,"Date")).rangeRound([0,o.plotAreaWidth]).paddingInner(.25).paddingOuter(0);!function(a,e,n,r,i){var l=function(t){var a;switch(t.windUnit){case"knots":a=1/.54;break;case"mph":a=1/.62137;break;case"m/s":a=3.6;break;default:a=1}var e={light:d3.interpolateRgb("#222222","#808080"),strong:d3.interpolateRgb("#C76100","#C70000")};return function(t){var n,r,i,l=t*a;l<50?(n="light",r=0,i=50):(n="strong",r=50,i=100);var d=(t-r)/(i-r);return d=Math.max(0,Math.min(d,1)),e[n](d)}}(n),d=a.append("g").attr("class",t("wind-region"));d.append("rect").attr("class",t("wind-region-background")).attr("x",0).attr("y",0).attr("width",r.plotAreaWidth).attr("height",r.windRegionHeight+r.regionSpacing/2);var o=d.append("g").attr("class",t("wind-icons")),s=d.append("g").attr("class",t("wind-arrows")),g=d.append("g").attr("class",t("wind-gust-labels")),u=d.append("g").attr("class",t("wind-direction-labels"));o.selectAll("wind-icon").data(n.data,i).enter().append("use").attr("xlink:href","#daily-weather-graph-wind-icon").attr("transform",function(t){if(t.HighWindGustBearing===n.missingValue)return"";var a=e(t.Date)+e.bandwidth()/2;return"translate("+(a-r.windSize/2)+",35)"}).style("fill",function(t){return t.HighWindGust===n.missingValue?"none":l(t.HighWindGust)}).style("stroke",function(t){if(t.HighWindGust===n.missingValue)return"none";var a=l(t.HighWindGust);return d3.rgb(a).darker(1.25)}),s.selectAll("wind-arrow").data(n.data,i).enter().append("use").attr("xlink:href","#daily-weather-graph-wind-indicator").attr("transform",function(t){if(t.HighWindGustBearing===n.missingValue)return"";var a=e(t.Date)+e.bandwidth()/2,i=45*Math.round(t.HighWindGustBearing/45);return"translate("+(a-r.windSize/2)+",35) rotate("+i+" "+r.windSize/2+" "+r.windSize/2+")"}).style("fill",function(t){return t.HighWindGustBearing===n.missingValue||0===Math.round(t.HighWindGust)?"none":"#000000"}).style("stroke",function(t){return t.HighWindGustBearing===n.missingValue||0===Math.round(t.HighWindGust)?"none":"#FFFFFF"}),g.selectAll("text.wind-gust-label").data(n.data,i).enter().append("text").attr("class",function(a){return a.HighWindGust===n.missingValue?t("na-label"):t("wind-gust-label")}).attr("x",function(t){return e(t.Date)+e.bandwidth()/2}).attr("y",35+r.windSize/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.HighWindGust===n.missingValue?n.missingValueText:Math.round(t.HighWindGust)}),u.selectAll("text.wind-direction-label").data(n.data,i).enter().append("text").attr("class",t("wind-direction-label")).attr("x",function(t){return e(t.Date)+e.bandwidth()/2}).attr("y",35).attr("text-anchor","middle").text(function(t){return t.HighWindGustBearing===n.missingValue||0===Math.round(t.HighWindGust)?"":(a=t.HighWindGustBearing,["N","NE","E","SE","S","SW","W","NW","N"][Math.round(a/45)]);var a}),d.append("text").attr("class",t("section-label")).attr("x",5).attr("y",5).attr("dy","0.8em").text("Peak wind gust ("+n.windUnit+")")}(c,h,i,o,p),function(a,n,r,i,l){var d=d3.scaleLinear().range([i.plotAreaHeight-i.rainRegionHeight-i.regionSpacing,i.windRegionHeight+i.regionSpacing]),o=e(r.data,"HighTemperature"),s=e(r.data,"LowTemperature"),g=o.concat(s).filter(function(t){return t!==r.missingValue}),u=d3.extent(g),p=u[1]-u[0];u[0]=Math.floor(u[0])-Math.max(1,.15*p),u[1]=Math.ceil(u[1])+Math.max(1,.25*p),d.domain(u);var c=d3.line().x(function(t){return n(t.Date)+n.bandwidth()/2}).y(function(t){return d(t.LowTemperature)}),h=d3.line().x(function(t){return n(t.Date)+n.bandwidth()/2}).y(function(t){return d(t.HighTemperature)});c.defined(function(t){return t.LowTemperature!==r.missingValue}),h.defined(function(t){return t.HighTemperature!==r.missingValue});var m=a.append("g").attr("class",t("temperature-region"));m.append("rect").attr("class",t("temperature-region-background")).attr("x",0).attr("y",i.windRegionHeight+i.regionSpacing/2).attr("width",i.plotAreaWidth).attr("height",i.tempRegionHeight+i.regionSpacing),m.append("path").attr("class",t("temperature-low-path")).attr("d",c(r.data)),m.append("path").attr("class",t("temperature-high-path")).attr("d",h(r.data));var f=m.append("g").attr("class",t("temperature-high-labels")),w=m.append("g").attr("class",t("temperature-low-labels"));f.append("g").selectAll("text").data(r.data,l).enter().append("text").attr("class",t("temperature-high-label")).attr("x",function(t){return n(t.Date)+n.bandwidth()/2}).attr("y",function(t){return d(t.HighTemperature)}).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.HighTemperature===r.missingValue?"":t.HighTemperature}),w.append("g").selectAll("text").data(r.data,l).enter().append("text").attr("class",t("temperature-low-label")).attr("x",function(t){return n(t.Date)+n.bandwidth()/2}).attr("y",function(t){return d(t.LowTemperature)}).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.LowTemperature===r.missingValue?"":t.LowTemperature}),m.append("line").attr("class",t("region-separator")).attr("transform","translate(0,"+(i.windRegionHeight+i.regionSpacing/2)+")").attr("x1",0).attr("x2",i.plotAreaWidth).attr("y1",0).attr("y2",0),m.append("text").attr("class",t("section-label")).attr("x",5).attr("y",i.windRegionHeight+i.regionSpacing/2).attr("dy","1.3em").text("High and low temperatures (Â°"+r.temperatureUnit+")")}(c,h,i,o,p),function(a,n,r,i,l){var d="inches"===r.rainUnit?.4:10,o="inches"===r.rainUnit?2:1,s=e(r.data,"Rainfall").filter(function(t){return t!==r.missingValue}),g=d3.scaleLinear().range([0,i.rainRegionHeight-30]).domain([0,Math.max(d,d3.max(s))]).clamp(!0),u=function(t){var a="inches"===t.rainUnit?2:50,e=d3.interpolateRgb("#4BA7EB","#0023AD");return function(t){var n=Math.max(0,Math.min(t/a,1));return e(n)}}(r),p=a.append("g").attr("class",t("rain-region"));p.append("rect").attr("class",t("rain-region-background")).attr("x",0).attr("y",i.plotAreaHeight-i.rainRegionHeight-i.regionSpacing/2).attr("width",i.plotAreaWidth).attr("height",i.rainRegionHeight+i.regionSpacing/2);var c=p.append("g").attr("class",t("rain-bars")),h=p.append("g").attr("class",t("rain-labels"));c.selectAll("rect.rain-bar").data(r.data,l).enter().append("rect").attr("class",t("rain-bar")).style("fill",function(t){return 0===t.Rainfall||t.Rainfall===r.missingValue?"none":u(t.Rainfall)}).style("stroke",function(t){if(0===t.Rainfall||t.Rainfall===r.missingValue)return"none";var a=u(t.Rainfall);return d3.rgb(a).darker(.8)}).attr("x",function(t){return n(t.Date)}).attr("y",function(t){return i.plotAreaHeight-(t.Rainfall===r.missingValue?0:g(t.Rainfall))}).attr("width",n.bandwidth()).attr("height",function(t){return t.Rainfall===r.missingValue?0:g(t.Rainfall)}),h.selectAll("text.rain-label").data(r.data,l).enter().append("text").attr("class",function(a){return a.Rainfall===r.missingValue?t("missing-label"):t("rain-label")}).attr("text-anchor","middle").attr("x",function(t){return n(t.Date)+n.bandwidth()/2}).attr("y",function(t){var a=t.Rainfall===r.missingValue?0:t.Rainfall;return i.plotAreaHeight-g(a)-8}).style("font-size",function(t){return 0===t.Rainfall?"15px":""}).text(function(t){if(t.Rainfall>0){var a=Math.pow(10,o),e=Math.round(a*t.Rainfall)/a;return e<.1&&(e=(""+e).substring(1)),e}return 0===t.Rainfall?".":r.missingValueText}),p.append("text").attr("class",t("section-label")).attr("x",5).attr("y",i.plotAreaHeight-i.rainRegionHeight-i.regionSpacing/2).attr("dy","1.3em").text("Daily rainfall ("+r.rainfallUnit+")"),p.append("text").attr("class",t("statistic-label")).attr("x",i.plotAreaWidth-5).attr("y",i.plotAreaHeight-i.rainRegionHeight-i.regionSpacing/2).attr("text-anchor","end").attr("dy","1.3em").text("Total: "+d3.sum(s).toFixed(o)),p.append("line").attr("class",t("region-separator")).attr("transform","translate(0,"+(i.plotAreaHeight-i.rainRegionHeight-i.regionSpacing/2)+")").attr("x1",0).attr("x2",i.plotAreaWidth).attr("y1",0).attr("y2",0)}(c,h,i,o,p);for(var m=d3.timeFormat(i.dateFormat),f=d3.timeParse(m),w=i.data.map(function(t){return f(t.Date).getDate()}),x=w.indexOf(1);-1!==x;){if(x<d&&x>0){var y=data[x-1].Date,H=data[x].Date,b=(h(y)+h(H))/2+h.bandwidth()/2;c.append("line").attr("class",t("vertical-separator")).attr("x1",b).attr("x2",b).attr("y1",o.marginTop).attr("y2",o.plotAreaHeight+20)}x=w.indexOf(1,x+1)}var R=c.append("line").attr("x1",0).attr("x2",0).attr("y1",o.marginTop).attr("y2",o.plotAreaHeight).style("stroke","#BBB").style("stroke-width","1px").style("stroke-opacity",0),v=d3.axisBottom().scale(h).tickSizeInner(0).tickSizeOuter(.5).tickFormat(function(t){return parseInt(t.substr(-2),10)});c.append("g").attr("class",t("axis")+" "+t("x-axis")).attr("transform","translate(0,"+o.plotAreaHeight+")").call(v).selectAll("text").attr("dy","1.4em").style("font-size","11px"),u.on("mousemove",function(){var t=d3.mouse(g.node()),a=g.node().createSVGPoint();a.x=t[0],a.y=t[1];var e=a.matrixTransform(g.node().getScreenCTM().inverse());R.attr("x1",e.x),R.attr("x2",e.x)}),u.on("mouseover",function(){R.style("stroke-opacity",.8)}),u.on("mouseout",function(){R.style("stroke-opacity",0)})};function t(t){return"dwg-"+t}function a(t,a){return Object.prototype.hasOwnProperty.call(t,a)}function e(t,a){return t.map(function(t){return t[a]})}}();