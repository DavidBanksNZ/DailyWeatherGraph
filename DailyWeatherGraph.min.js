!function(){"use-strict";function t(t,a){var e=t.append("g").attr("id","daily-weather-graph-wind-icon");e.append("circle").attr("cx",a.windSize/2).attr("cy",a.windSize/2).attr("stroke-width","1.3px").attr("r",a.windCircleRadius);var n=t.append("g").attr("id","daily-weather-graph-wind-indicator"),r=a.windSize/2-a.windCircleRadius+4,i=8,l=r-i,o=a.windSize/2-i/2,d=a.windSize/2+i/2;n.append("path").attr("d","M"+o+","+l+" L"+d+","+l+" L"+a.windSize/2+","+r+" L"+o+","+l)}function a(t,a,e,n,r){var i=10,o="inches"==e.rainUnit?2:1;"inches"==e.rainUnit&&(i/=25.4);var s=l(e.data,"Rainfall").filter(function(t){return t!==e.missingValue}),g=d3.scale.linear().range([0,n.rainRegionHeight-30]).domain([0,Math.max(i,d3.max(s))]).clamp(!0),u=d(e),p=t.append("g").attr("class","rain-region");p.append("rect").attr("class","rain-region-background").attr("x",0).attr("y",n.plotAreaHeight-n.rainRegionHeight-n.regionSpacing/2).attr("width",n.plotAreaWidth).attr("height",n.rainRegionHeight+n.regionSpacing/2);var c=p.append("g").attr("class","rain-bars"),h=p.append("g").attr("class","rain-labels");c.selectAll("rect.rain-bar").data(e.data,r).enter().append("rect").attr("class","rain-bar").style("fill",function(t){return 0===t.Rainfall||t.Rainfall===e.missingValue?"none":u(t.Rainfall)}).style("stroke",function(t){if(0===t.Rainfall||t.Rainfall===e.missingValue)return"none";var a=u(t.Rainfall);return d3.rgb(a).darker(.8)}).attr("x",function(t){return a(t.Date)}).attr("y",function(t){return n.plotAreaHeight-(t.Rainfall===e.missingValue?0:g(t.Rainfall))}).attr("width",a.rangeBand()).attr("height",function(t){return t.Rainfall===e.missingValue?0:g(t.Rainfall)}),h.selectAll("text.rain-label").data(e.data,r).enter().append("text").attr("class",function(t){return t.Rainfall===e.missingValue?"missing-label":"rain-label"}).attr("text-anchor","middle").attr("x",function(t){return a(t.Date)+a.rangeBand()/2}).attr("y",function(t){var a=t.Rainfall===e.missingValue?0:t.Rainfall;return n.plotAreaHeight-g(a)-8}).style("font-size",function(t){return 0===t.Rainfall?"15px":""}).text(function(t){if(t.Rainfall>0){var a=Math.pow(10,o),n=Math.round(a*t.Rainfall)/a;return.1>n&&(n=(""+n).substring(1)),n}return 0===t.Rainfall?".":e.missingValueText}),p.append("text").attr("class","section-label").attr("x",5).attr("y",n.plotAreaHeight-n.rainRegionHeight-n.regionSpacing/2).attr("dy","1.3em").text("Daily rainfall ("+e.rainfallUnit+")"),p.append("text").attr("class","statistic-label").attr("x",n.plotAreaWidth-5).attr("y",n.plotAreaHeight-n.rainRegionHeight-n.regionSpacing/2).attr("text-anchor","end").attr("dy","1.3em").text("Total: "+d3.sum(s).toFixed(o)),p.append("line").attr("class","region-separator").attr("transform","translate(0,"+(n.plotAreaHeight-n.rainRegionHeight-n.regionSpacing/2)+")").attr("x1",0).attr("x2",n.plotAreaWidth).attr("y1",0).attr("y2",0)}function e(t,a,e,n,r){var i=d3.scale.linear().range([n.plotAreaHeight-n.rainRegionHeight-n.regionSpacing,n.windRegionHeight+n.regionSpacing]),o=l(e.data,"HighTemperature"),d=l(e.data,"LowTemperature"),s=o.concat(d).filter(function(t){return t!==e.missingValue}),g=d3.extent(s),u=g[1]-g[0];g[0]=Math.floor(g[0])-Math.max(1,.15*u),g[1]=Math.ceil(g[1])+Math.max(1,.25*u),i.domain(g);var p=d3.svg.line().x(function(t){return a(t.Date)+a.rangeBand()/2}).y(function(t){return i(t.LowTemperature)}),c=d3.svg.line().x(function(t){return a(t.Date)+a.rangeBand()/2}).y(function(t){return i(t.HighTemperature)});p.defined(function(t){return t.LowTemperature!==e.missingValue}),c.defined(function(t){return t.HighTemperature!==e.missingValue});var h=t.append("g").attr("class","temperature-region");h.append("rect").attr("class","temperature-region-background").attr("x",0).attr("y",n.windRegionHeight+n.regionSpacing/2).attr("width",n.plotAreaWidth).attr("height",n.tempRegionHeight+n.regionSpacing),h.append("path").attr("class","temperature-low-path").attr("d",p(e.data)),h.append("path").attr("class","temperature-high-path").attr("d",c(e.data));var m=h.append("g").attr("class","temperature-high-labels"),f=h.append("g").attr("class","temperature-low-labels");m.append("g").selectAll("text").data(e.data,r).enter().append("text").attr("class","temperature-high-label").attr("x",function(t){return a(t.Date)+a.rangeBand()/2}).attr("y",function(t){return i(t.HighTemperature)}).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.HighTemperature===e.missingValue?"":t.HighTemperature}),f.append("g").selectAll("text").data(e.data,r).enter().append("text").attr("class","temperature-low-label").attr("x",function(t){return a(t.Date)+a.rangeBand()/2}).attr("y",function(t){return i(t.LowTemperature)}).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.LowTemperature===e.missingValue?"":t.LowTemperature}),h.append("line").attr("class","region-separator").attr("transform","translate(0,"+(n.windRegionHeight+n.regionSpacing/2)+")").attr("x1",0).attr("x2",n.plotAreaWidth).attr("y1",0).attr("y2",0),h.append("text").attr("class","section-label").attr("x",5).attr("y",n.windRegionHeight+n.regionSpacing/2).attr("dy","1.3em").text("High and low temperatures (Â°"+e.temperatureUnit+")")}function n(t,a,e,n,r){var i=s(e),l=35,d=t.append("g").attr("class","wind-region");d.append("rect").attr("class","wind-region-background").attr("x",0).attr("y",0).attr("width",n.plotAreaWidth).attr("height",n.windRegionHeight+n.regionSpacing/2);var g=d.append("g").attr("class","wind-icons"),u=d.append("g").attr("class","wind-arrows"),p=d.append("g").attr("class","wind-gust-labels"),c=d.append("g").attr("class","wind-direction-labels");g.selectAll("wind-icon").data(e.data,r).enter().append("use").attr("xlink:href","#daily-weather-graph-wind-icon").attr("transform",function(t){if(t.HighWindGustBearing===e.missingValue)return"";var r=a(t.Date)+a.rangeBand()/2;return"translate("+(r-n.windSize/2)+","+l+")"}).style("fill",function(t){return t.HighWindGust===e.missingValue?"none":i(t.HighWindGust)}).style("stroke",function(t){if(t.HighWindGust===e.missingValue)return"none";var a=i(t.HighWindGust);return d3.rgb(a).darker(1.25)}),u.selectAll("wind-arrow").data(e.data,r).enter().append("use").attr("xlink:href","#daily-weather-graph-wind-indicator").attr("transform",function(t){if(t.HighWindGustBearing===e.missingValue)return"";var r=a(t.Date)+a.rangeBand()/2,i=45*Math.round(t.HighWindGustBearing/45);return"translate("+(r-n.windSize/2)+",35) rotate("+i+" "+n.windSize/2+" "+n.windSize/2+")"}).style("fill",function(t){return t.HighWindGustBearing===e.missingValue||0===Math.round(t.HighWindGust)?"none":"#000000"}).style("stroke",function(t){return t.HighWindGustBearing===e.missingValue||0===Math.round(t.HighWindGust)?"none":"#FFFFFF"}),p.selectAll("text.wind-gust-label").data(e.data,r).enter().append("text").attr("class",function(t){return t.HighWindGust===e.missingValue?"na-label":"wind-gust-label"}).attr("x",function(t){return a(t.Date)+a.rangeBand()/2}).attr("y",l+n.windSize/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(t){return t.HighWindGust===e.missingValue?e.missingValueText:Math.round(t.HighWindGust)}),c.selectAll("text.wind-direction-label").data(e.data,r).enter().append("text").attr("class","wind-direction-label").attr("x",function(t){return a(t.Date)+a.rangeBand()/2}).attr("y",l).attr("text-anchor","middle").text(function(t){return t.HighWindGustBearing===e.missingValue||0===Math.round(t.HighWindGust)?"":o(t.HighWindGustBearing)}),d.append("text").attr("class","section-label").attr("x",5).attr("y",5).attr("dy","0.8em").text("Peak wind gust ("+e.windUnit+")")}function r(t,a){return Object.prototype.hasOwnProperty.call(t,a)}function i(t){var a={};for(var e in t)r(t,e)&&(a[e]=t[e]);return a}function l(t,a){var e=[];return t.forEach(function(t){e.push(t[a])}),e}function o(t){var a=["N","NE","E","SE","S","SW","W","NW","N"];return a[Math.round(t/45)]}function d(t){var a=50,e=0;"inches"===t.rainUnit&&(a/=25.4);var n=d3.interpolateRgb("#4BA7EB","#0023AD");return function(t){var r=(t-e)/(a-e);return r=Math.max(0,Math.min(r,1)),n(r)}}function s(t){var a,e=0,n=50,r=100;switch(t.windUnit){case"knots":a=1/.54;break;case"mph":a=1/.62137;break;case"m/s":a=3.6;break;default:a=1}var i={light:d3.interpolateRgb("#222222","#808080"),strong:d3.interpolateRgb("#C76100","#C70000")};return function(t){var l,o,d,s=t*a;n>s?(l="light",o=e,d=n):(l="strong",o=n,d=r);var g=(t-o)/(d-o);return g=Math.max(0,Math.min(g,1)),i[l](g)}}window.DailyWeatherGraph=function(o){var d={width:800,height:375,dateFormat:"%Y-%m-%d",missingValue:null,missingValueText:"n/a",temperatureUnit:"C",rainfallUnit:"mm",windUnit:"km/h"},s=i(o);for(var g in d)r(s,g)||(s[g]=d[g]);var u=s.data.length,p={marginTop:10,marginRight:10,marginBottom:30,marginLeft:10,regionSpacing:30,windRegionHeight:70,rainRegionHeightProp:.375,tempRegionHeightProp:.625,windSize:50,windCircleRadius:12};p.plotAreaWidth=s.width-p.marginLeft-p.marginRight,p.plotAreaHeight=s.height-p.marginTop-p.marginBottom;var c=s.height-p.marginTop-p.marginBottom-2*p.regionSpacing-p.windRegionHeight;p.rainRegionHeight=c*p.rainRegionHeightProp,p.tempRegionHeight=c*p.tempRegionHeightProp,s.container.html("");var h=s.container.append("svg").attr("width",s.width).attr("height",s.height).attr("class","daily-weather-graph");h.append("rect").attr("class","graph-background").attr("x",0).attr("y",0).attr("width",s.width).attr("height",s.height);var m=h.append("rect").attr("class","plot-area-background").attr("x",p.marginLeft).attr("y",p.marginTop).attr("width",p.plotAreaWidth).attr("height",p.plotAreaHeight).attr("pointer-events","all"),f=function(t){return t.Date},x=h.append("defs");t(x,p);var w=h.append("g").attr("class","plot-area").attr("transform","translate("+p.marginLeft+","+p.marginTop+")").attr("pointer-events","none"),y=d3.scale.ordinal().domain(l(s.data,"Date")).rangeRoundBands([0,p.plotAreaWidth],.25);n(w,y,s,p,f),e(w,y,s,p,f),a(w,y,s,p,f);for(var H=d3.time.format(s.dateFormat),v=s.data.map(function(t){return H.parse(t.Date).getDate()}),R=v.indexOf(1);-1!==R;){if(u>R&&R>0){var b=data[R-1].Date,S=data[R].Date,A=(y(b)+y(S))/2+y.rangeBand()/2;w.append("line").attr("class","vertical-separator").attr("x1",A).attr("x2",A).attr("y1",p.marginTop).attr("y2",p.plotAreaHeight+20)}R=v.indexOf(1,R+1)}var W=w.append("line").attr("x1",0).attr("x2",0).attr("y1",p.marginTop).attr("y2",p.plotAreaHeight).attr("id","graph-cursor").style("stroke","#BBB").style("stroke-width","1px").style("stroke-opacity",0),k=d3.svg.axis().scale(y).orient("bottom").outerTickSize(0).innerTickSize(0).tickFormat(function(t){var a=t.split("-");return parseInt(a[2],10)});w.append("g").attr("class","axis x-axis").attr("transform","translate(0,"+p.plotAreaHeight+")").call(k).selectAll("text").attr("dy","1.4em").style("font-size","11px"),m.on("mousemove",function(){var t=d3.mouse(h.node()),a=h.node().createSVGPoint();a.x=t[0],a.y=t[1];var e=a.matrixTransform(h.node().getScreenCTM().inverse());W.attr("x1",e.x),W.attr("x2",e.x)}),m.on("mouseover",function(){W.style("stroke-opacity",.8)}),m.on("mouseout",function(){W.style("stroke-opacity",0)})}}();